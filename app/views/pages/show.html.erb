<head>
<style>
h1 {text-align:center;}
p {text-align:center;}
a {text-align:center;}
</style>

<br>
<p>
<a href="/">Back to home</a><br><a href="/game_page">Restart game</a><br><a href="/attempts">Knowledge unlocked</a>
</p>


<canvas id="game"></canvas>

    <style>
      *{ margin: 0px; padding: 0px; }
      canvas{ display: block; margin: 0px auto; border: 1px solid #000;}
    </style>



<script>


var hirigana = [["あ","a",0,0,"id"],["い","i",0,0,"id"],["う","u",0,0,"id"],["え","e",0,0,"id"],["お","o",0,0,"id"],
    ["か","ka",0,0,"id"],["き","ki",0,0,"id"],["く","ku",0,0,"id"],["け","ke",0,0,"id"],["こ","ko",0,0,"id"],
    ["が","ga",0,0,"id"],["ぎ","gi",0,0,"id"],["ぐ","gu",0,0,"id"],["げ","ge",0,0,"id"],["ご","go",0,0,"id"],
    ["さ","sa",0,0,"id"],["し","shi",0,0,"id"],["す","su",0,0,"id"],["せ","se",0,0,"id"],["そ","so",0,0,"id"],
    ["ざ","za",0,0,"id"],["じ","ji",0,0,"id"],["ず","zu",0,0,"id"],["ぜ","ze",0,0,"id"],["ぞ","zo",0,0,"id"],
    ["た","ta",0,0,"id"],["ち","chi",0,0,"id"],["つ","tsu",0,0,"id"],["て","te",0,0,"id"],["と","to",0,0,"id"],
    ["だ","da",0,0,"id"],["ぢ","ji",0,0,"id"],["づ","zu",0,0,"id"],["で","de",0,0,"id"],["ど", "do",0,0,"id"],
    ["な","na",0,0,"id"],["に","ni",0,0,"id"],["ぬ","nu",0,0,"id"],["ね","ne",0,0,"id"],["の","no",0,0,"id"],
    ["は","ha",0,0,"id"],["ひ","hi",0,0,"id"],["ふ","fu",0,0,"id"],["へ","he",0,0,"id"],["ほ","ho",0,0,"id"],
    ["ば","ba",0,0,"id"],["び","bi",0,0,"id"],["ぶ","bu",0,0,"id"],["べ","be",0,0,"id"],["ぼ","bo",0,0,"id"],
    ["ぱ","pa",0,0,"id"],["ぴ","pi",0,0,"id"],["ぷ","pu",0,0,"id"],["ぺ","pe",0,0,"id"],["ぽ","po",0,0,"id"],
    ["ま","ma",0,0,"id"],["み","mi",0,0,"id"],["む","mu",0,0,"id"],["め","me",0,0,"id"],["も","mo",0,0,"id"],
    ["や","ya",0,0,"id"],["ゆ","yu",0,0,"id"],["よ","yo",0,0,"id"],
    ["ら","ra",0,0,"id"],["り","ri",0,0,"id"],["る","ru",0,0,"id"],["れ","re",0,0,"id"],["ろ","ro",0,0,"id"],
    ["わ","wa",0,0,"id"],["を","wo",0,0,"id"],["ん","n/m",0,0,"id"],
    ["きゃ","kya",0,0,"id"],["きゅ","kyu",0,0,"id"],["きょ","kyo",0,0,"id"],
    ["ぎゃ","gya",0,0,"id"],["ぎゅ","gyu",0,0,"id"],["ぎょ","gyo",0,0,"id"],
    ["しゃ","sha",0,0,"id"],["しゅ","shu",0,0,"id"],["しょ","sho",0,0,"id"],
    ["じゃ","ja",0,0,"id"],["じゅ","ju",0,0,"id"],["じょ","jo",0,0,"id"],
    ["ちゃ","cha",0,0,"id"],["ちゅ","chu",0,0,"id"],["ちょ","cho",0,0,"id"],
    ["にゃ","nya",0,0,"id"],["にゅ","nyu",0,0,"id"],["にょ","nyo",0,0,"id"],
    ["ひゃ","hya",0,0,"id"],["ひゅ","hyu",0,0,"id"],["ひょ ","hyo",0,0,"id"],
    ["びゃ","bya",0,0,"id"],["びゅ","byu",0,0,"id"],["びょ","byo",0,0,"id"],
    ["ぴゃ","pya",0,0,"id"],["ぴゅ","pyu",0,0,"id"],["ぴょ","pyo",0,0,"id"],
    ["みゃ","mya",0,0,"id"],["みゅ","myu",0,0,"id"],["みょ","myo",0,0,"id"],
    ["りゃ","rya",0,0,"id"],["りゅ","ryu",0,0,"id"],["りょ","ryo",0,0,"id"]];



var result = "default";
charArray =[["あ","a",0,0],["い","i",0,0],["う","u",0,0],["え","e",0,0],["お","o",0,0],["か","ka",0,0],["き","ki",0,0],["く","ku",0,0],["け","ke",0,0],["こ","ko",0,0]];

function CreateQ(array) {
  var orderArray = [];
  var answerArray = [];
  var question = [];
  var jAnswers = [];
  var jAnswerValues = [];
  for(i = 0; i < array.length; i++) {
    orderArray.push(i);
  }
  for(i = 0; i<3; i++){
    val1 = Math.floor((Math.random() * orderArray.length));
    answerArray.push(orderArray[val1]);
    orderArray.splice(val1,1);
  }
  question.push(array[answerArray[0]]);
  var orderArray2 = [];
  for(i = 0; i < answerArray.length; i++) {
    orderArray2.push(i);
  }
  for(i = 0; i<answerArray.length; i++){
    val1 = Math.floor((Math.random() * orderArray2.length));
    jAnswers.push(orderArray2[val1]);
    orderArray2.splice(val1,1);
  }
  jAnswerValues.push(array[answerArray[jAnswers[0]]]);
  jAnswerValues.push(array[answerArray[jAnswers[1]]]);
  jAnswerValues.push(array[answerArray[jAnswers[2]]]);
  return [question, jAnswerValues];
}

var orderArray = [0,1];
orderArray = RandArr(orderArray);
demo2 = orderArray[0];
var gameOver = false;

demo = CreateQ(charArray);
//demo2 = demo[1][2][1];
var question = demo[0][0];

//var question = demo[0][0][0];
var a1 = demo[1][0]
var a1Display = a1[1];
var a2 = demo[1][1];
var a2Display = a2[1];
var a3 = demo[1][2]
var a3Display = a3[1];
var response = "";
var textResponse = "";
var textResponse2 = "";
var bonusPoints= 0;

var a1Color = "#D2D2D2";
var a2Color = "#D2D2D2";
var a3Color = "#D2D2D2";

var lowBoxColor = "#D2D2D2";
var highBoxColor = "#D2D2D2";



if (a1 == question) {
  check = "bingo";
}

var demo;
var Width = 230;  //800


 var Height = 450;

var canvas = document.getElementById("game");

canvas.width = Width;

canvas.height = Height;

canvas.setAttribute('tabindex', 1);

var ctx = canvas.getContext("2d");

var FPS = 1000 / 60;

var gameTimeStart;
var cardArray = [];
var mYcd;  //mouseYcoord
var mXcd;  //mouseXcoord
var counter = 0;
RectX = 50;
RectY = 50;
var keyIn;
var dragok = false;
var deck =  [[1,"h"],[2,"h"],[3,"h"],[4,"h"],[5,"h"],[6,"h"],[7,"h"],[8,"h"],[9,"h"],[10,"h"],[11,"h"],[12,"h"],[13,"h"],
    [1,"c"],[2,"c"],[3,"c"],[4,"c"],[5,"c"],[6,"c"],[7,"c"],[8,"c"],[9,"c"],[10,"c"],[11,"c"],[12,"c"],[13,"c"],
    [1,"d"],[2,"d"],[3,"d"],[4,"d"],[5,"d"],[6,"d"],[7,"d"],[8,"d"],[9,"d"],[10,"d"],[11,"d"],[12,"d"],[13,"d"],
    [1,"s"],[2,"s"],[3,"s"],[4,"s"],[5,"s"],[6,"s"],[7,"s"],[8,"s"],[9,"s"],[10,"s"],[11,"s"],[12,"s"],[13,"s"]/*,[1,"h"],[2,"h"],[3,"h"],[4,"h"],    [5,"h"],[6,"h"],[7,"h"],[8,"h"],[9,"h"],[10,"h"],[11,"h"],[12,"h"],[13,"h"],
    [1,"c"],[2,"c"],[3,"c"],[4,"c"],[5,"c"],[6,"c"],[7,"c"],[8,"c"],[9,"c"],[10,"c"],[11,"c"],[12,"c"],[13,"c"],
    [1,"d"],[2,"d"],[3,"d"],[4,"d"],[5,"d"],[6,"d"],[7,"d"],[8,"d"],[9,"d"],[10,"d"],[11,"d"],[12,"d"],[13,"d"],
    [1,"s"],[2,"s"],[3,"s"],[4,"s"],[5,"s"],[6,"s"],[7,"s"],[8,"s"],[9,"s"],[10,"s"],[11,"s"],[12,"s"],[13,"s"]*/]
var questionPool = [["あ","a"],["い","i"],["う","u"],["え","e"],["お","o"]]

var discard = [];
var drawnCard;
var dealerCard = "";
var bet;
var highLow = "";
var outcome = "";// = "blank";
var chips = 1000;
var multiplier = 1;
var gameState = "blank";  //could be resolve pt 1, resolve pt 2, etc
var check;
var gameHistory = [];
var a1State = "off";
var a2State = "off";
var a3State = "off";
var power = 100;
var adjusted = "";
var dealerCardX = 200;
var highLowX = 100;
var answerScreen = true;
var answerState;// = false;
var questionFilter = true;
var questionState;// = true;
var splitMasterA = [];
var easyArray = [["<%= @game_input[0] %>","<%= @game_input[1] %>",0,0,"<%= @game_input[2] %>","<%= @game_input[3] %>"],
                ["<%= @game_input[4] %>","<%= @game_input[5] %>",0,0,"<%= @game_input[6] %>","<%= @game_input[7] %>"],
                ["<%= @game_input[8] %>","<%= @game_input[9] %>",0,0,"<%= @game_input[10] %>","<%= @game_input[11] %>"],
                ["<%= @game_input[12] %>","<%= @game_input[13] %>",0,0,"<%= @game_input[14] %>","<%= @game_input[15] %>"],
                ["<%= @game_input[16] %>","<%= @game_input[17] %>",0,0,"<%= @game_input[18] %>","<%= @game_input[19] %>"],
                ];
var medArray = []//[["呀","ya",0,0,"(cute)"],["苹果","píngguǒ",0,0,"apple"],["怎么","zěnme",0,0,"how"],["爱","ài",0,0,"love"],["都","dōu",0,0,"all"]];
var hardArray = [];

var displayIndex = [0,1,4];
displayIndex = RandArr(displayIndex);

var dataCharacter = "data Character";
var dataCorrect = "0";

var testArray1 = [];

splitMasterA.push(easyArray);  //occurs when game starts
splitMasterA.push(medArray);  //occurs when game starts
splitMasterA.push(hardArray); //occurs when game starts


var SplitMasterARand; //runs each time
SplitMasterARand = GenRN(splitMasterA.length);  // random 0 - 2, runs each time

var possValues = [0,1,2];
possValues = RandArr(possValues);
var tempHH;
var newQuestion = [];

  if(medArray.length == 0 && hardArray.length >0 && easyArray.length >0) {
    for(i = possValues.length; i >0; i--) {
      possValues.splice(i-1,1);
    }
    possValues = [0,2];
    possValues = RandArr(possValues);
    SplitMasterARand = possValues[0];
    newQuestion.push(splitMasterA[SplitMasterARand][GenRN(splitMasterA[SplitMasterARand].length)]);
    dataCharacter = newQuestion[0];
  } else if (hardArray.length == 0  && medArray.length >0 && easyArray.length >0) {
    for(i = possValues.length; i >0; i--) {
      possValues.splice(i-1,1);
    }
    possValues = [0,1];
    possValues = RandArr(possValues);
    SplitMasterARand = possValues[0];
    newQuestion.push(splitMasterA[SplitMasterARand][GenRN(splitMasterA[SplitMasterARand].length)]);
    dataCharacter = newQuestion[0];
  } else if (easyArray.length == 0  && medArray.length >0 && hardArray.length >0) {
    for(i = possValues.length; i >0; i--) {
      possValues.splice(i-1,1);
    }
    possValues = [1,2];
    possValues = RandArr(possValues);
    SplitMasterARand = possValues[0];
    newQuestion.push(splitMasterA[SplitMasterARand][GenRN(splitMasterA[SplitMasterARand].length)]);
    dataCharacter = newQuestion[0];
  } else if (easyArray.length == 0  && medArray.length == 0 && hardArray.length >0) {
    SplitMasterARand = 2;
    newQuestion.push(splitMasterA[SplitMasterARand][GenRN(splitMasterA[SplitMasterARand].length)]);
    dataCharacter = newQuestion[0];
  } else if (easyArray.length > 0  && medArray.length == 0 && hardArray.length == 0) {
    SplitMasterARand = 0;
    newQuestion.push(splitMasterA[SplitMasterARand][GenRN(splitMasterA[SplitMasterARand].length)]);
    dataCharacter = newQuestion[0];
  } else if (easyArray.length == 0  && medArray.length > 0 && hardArray.length == 0) {
    SplitMasterARand = 1;
    newQuestion.push(splitMasterA[SplitMasterARand][GenRN(splitMasterA[SplitMasterARand].length)]);
    dataCharacter = newQuestion[0];
  } else if (easyArray.length > 0  && medArray.length >0 && hardArray.length >0) {
    for(i = possValues.length; i >0; i--) {
      possValues.splice(i-1,1);
    }
    possValues = [0,1,2];
    possValues = RandArr(possValues);
    SplitMasterARand = possValues[0];
    newQuestion.push(splitMasterA[SplitMasterARand][GenRN(splitMasterA[SplitMasterARand].length)]);
    dataCharacter = newQuestion[0];
  }


var concMasterA = [];
for (i = 0; i < splitMasterA.length; i++) {
  for (j = 0; j < splitMasterA[i].length; j++) {
    concMasterA.push(splitMasterA[i][j]);
  }
}

var masterAIndex;
for(i = 0; i < concMasterA.length; i++) {
  if(newQuestion[0][0] == concMasterA[i][0]) {
    masterAIndex = i;
  }
}
var newAnswerBank = [];
newAnswerBank.push(concMasterA[masterAIndex]);
concMasterA.splice(masterAIndex,1);

var concMasterARand;  //create var to store temp var values

concMasterARand = GenRN(concMasterA.length);
newAnswerBank.push(concMasterA[concMasterARand]);
concMasterA.splice(concMasterARand,1);

concMasterARand = GenRN(concMasterA.length);
newAnswerBank.push(concMasterA[concMasterARand]);
concMasterA.splice(concMasterARand,1);

newAnswerBank = RandArr(newAnswerBank);



function UpdateQues() {
  displayIndex = RandArr(displayIndex);
  newQuestion.splice(0,1);
  for(i = splitMasterA.length; i>0; i--){
    splitMasterA.splice(i-1,1);
  }
  for(i = concMasterA.length; i>0; i--){
    concMasterA.splice(i-1,1);
  }
  for(i = newAnswerBank.length; i>0; i--){
    newAnswerBank.splice(i-1,1);
  }
  concMasterARand = "default";
  SplitMasterARand = "default";
  masterAIndex = "default";

  splitMasterA.push(easyArray);
  splitMasterA.push(medArray);
  splitMasterA.push(hardArray);

  possValues = [0,1,2];
  possValues = RandArr(possValues);
  SplitMasterARand = possValues[0];

  if(medArray.length == 0 && hardArray.length >0 && easyArray.length >0) {
    for(i = possValues.length; i >0; i--) {
      possValues.splice(i-1,1);
    }
    possValues = [0,2];
    possValues = RandArr(possValues);
    SplitMasterARand = possValues[0];
    newQuestion.push(splitMasterA[SplitMasterARand][GenRN(splitMasterA[SplitMasterARand].length)]);
    dataCharacter = newQuestion[0];
  } else if (hardArray.length == 0  && medArray.length >0 && easyArray.length >0) {
    for(i = possValues.length; i >0; i--) {
      possValues.splice(i-1,1);
    }
    possValues = [0,1];
    possValues = RandArr(possValues);
    SplitMasterARand = possValues[0];
    newQuestion.push(splitMasterA[SplitMasterARand][GenRN(splitMasterA[SplitMasterARand].length)]);
    dataCharacter = newQuestion[0];
  } else if (easyArray.length == 0  && medArray.length >0 && hardArray.length >0) {
    for(i = possValues.length; i >0; i--) {
      possValues.splice(i-1,1);
    }
    possValues = [1,2];
    possValues = RandArr(possValues);
    SplitMasterARand = possValues[0];
    newQuestion.push(splitMasterA[SplitMasterARand][GenRN(splitMasterA[SplitMasterARand].length)]);
    dataCharacter = newQuestion[0];
  } else if (easyArray.length == 0  && medArray.length == 0 && hardArray.length >0) {
    SplitMasterARand = 2;
    newQuestion.push(splitMasterA[SplitMasterARand][GenRN(splitMasterA[SplitMasterARand].length)]);
    dataCharacter = newQuestion[0];
  } else if (easyArray.length > 0  && medArray.length == 0 && hardArray.length ==0) {
    SplitMasterARand = 0;
    newQuestion.push(splitMasterA[SplitMasterARand][GenRN(splitMasterA[SplitMasterARand].length)]);
    dataCharacter = newQuestion[0];
  } else if (easyArray.length == 0  && medArray.length > 0 && hardArray.length == 0) {
    SplitMasterARand = 1;
    newQuestion.push(splitMasterA[SplitMasterARand][GenRN(splitMasterA[SplitMasterARand].length)]);
    dataCharacter = newQuestion[0];
  } else if (easyArray.length > 0  && medArray.length >0 && hardArray.length >0) {
    for(i = possValues.length; i >0; i--) {
      possValues.splice(i-1,1);
    }
    possValues = [0,1,2];
    possValues = RandArr(possValues);
    SplitMasterARand = possValues[0];
    newQuestion.push(splitMasterA[SplitMasterARand][GenRN(splitMasterA[SplitMasterARand].length)]);
    dataCharacter = newQuestion[0];
  }

  for (i = 0; i < splitMasterA.length; i++) {
    for (j = 0; j < splitMasterA[i].length; j++) {
      concMasterA.push(splitMasterA[i][j]);
    }
  }

  for(s = 0; s < concMasterA.length; s++) {
    if(newQuestion[0][0] == concMasterA[s][0]) {
      masterAIndex = s;
    }
  }

  newAnswerBank.push(concMasterA[masterAIndex]);
  concMasterA.splice(masterAIndex,1);
  var concMasterARand;  //create var to store temp var values

  concMasterARand = GenRN(concMasterA.length);
  newAnswerBank.push(concMasterA[concMasterARand]);
  concMasterA.splice(concMasterARand,1);

  concMasterARand = GenRN(concMasterA.length);
  newAnswerBank.push(concMasterA[concMasterARand]);
  concMasterA.splice(concMasterARand,1);

  newAnswerBank = RandArr(newAnswerBank);
}

var BG = {

  Color: '#FFFFFF',

  Paint: function(){

    ctx.fillStyle = this.Color;

    ctx.fillRect(0, 0, Width, Height);

  }

};


function GenRN(limit) {  //returns (limit - 1) values
  return Math.floor(Math.random() * limit);
}
function RandArr(array) {
  jumbArray = [];
  while(array.length >0) {
    randNum = GenRN(array.length);
    jumbArray.push(array[randNum]);
    array.splice(randNum,1);
  }
  return jumbArray;
}
function compVal(a, b) {
  if(a > b && highLow == "high") {
    gameHistory.push("loss");
    dealerCardX = 333;
    textResponse = "Wrong  -"
    textResponse2= "It was ";
    answerState = false;
    return (-1);
  } else if(a > b && highLow == "low") {
    gameHistory.push("win");
    textResponse = "Correct +"
    textResponse2= "It was ";
    answerState = true;
    dealerCardX = 333;
    return 1;
  } else if(a < b && highLow == "low") {
    gameHistory.push("loss");
    textResponse = "Wrong  -"
    textResponse2= "It was ";
    dealerCardX = 333;
    answerState = false;
    return (-1);
  } else if(a < b && highLow == "high") {
    gameHistory.push("win");
    textResponse = "Correct +"
    textResponse2= "It was ";
    answerState = true;
    dealerCardX = 333;
    return 1;
  } else if(a == b && highLow == "low") {
    gameHistory.push("loss");
    textResponse = "Wrong  -"
    textResponse2= "It was ";
    answerState = false;
    dealerCardX = 333;
    return (-1);
  } else if(a == b && highLow == "high") {
    gameHistory.push("win");
    textResponse = "Correct +"
    textResponse2= "It was ";
    answerState = true;
    dealerCardX = 333;
    return 1;
  } else if(highLow == "") {
    return (-1);
  }
}

function DrawCard(array) {
  //drawnCard = array[array.length -1];
  var card = [];
  card.push(array[array.length - 1])
  array.splice(array.length -1);
  return card;
}
function Discard(array1, array2) {
  array2.push(array1[array1.length-1]);
  array1.splice(array1.length-1,1);
}
function RebalanceArrays() {
  for(i = hardArray.length; i > 0; i --) {      //first check for hardArray to easyArray
    if(hardArray[i-1][3]/hardArray[i-1][2] == 1) {
      easyArray.push(hardArray[i-1].slice(0,6));
      hardArray.splice(i-1,1);
    }
  }
  for(i = hardArray.length; i > 0; i --) {      //2nd check for hardArray to medArray
    if(hardArray[i-1][3]/hardArray[i-1][2] > .5 && hardArray[i-1][2] > 8) {
      medArray.push(hardArray[i-1].slice(0,6));
      hardArray.splice(i-1,1);
    }
  }
  for(i = medArray.length; i > 0; i --) {     //1st check for medArray to easyArray
    if(medArray[i-1][3]/medArray[i-1][2] > .75 && medArray[i-1][2] > 8) {
      easyArray.push(medArray[i-1].slice(0,6));
      medArray.splice(i-1,1);
    }
  }
  for(i = medArray.length; i > 0; i --) {     //2nd check for medArray to hardArray
    if(medArray[i-1][3]/medArray[i-1][2] < .5 && medArray[i-1][2] > 0) {
      hardArray.push(medArray[i-1].slice(0,6));
      medArray.splice(i-1,1);
    }
  }
  for(i = easyArray.length; i > 0; i --) {      //1st check for easyArray to medArray
    if(easyArray[i-1][3]/easyArray[i-1][2] < .75 && easyArray[i-1][2] > 0) {
      medArray.push(easyArray[i-1].slice(0,6));
      easyArray.splice(i-1,1);
    }
  }
  //if(hardArray.length == 0) {
  //  grabRandArrVal(1, hirigana, hardArray)
  //}
}
function ResolvePt1(){
  if(mYcd > 345 && mYcd < 380 && mXcd > 60 && mXcd < 155){
    dealerCard = DrawCard(deck);

    chips = chips + Math.round(keyIn * (power * compVal(drawnCard[0][0], dealerCard[0][0]))/100);
    adjusted =  Math.round(keyIn * (power * compVal(drawnCard[0][0], dealerCard[0][0]))/100);

    if(newAnswerBank[0][1] == newQuestion[0][1] && a1State == "on") {
      CountAsked2(newQuestion[0][0], easyArray);
      CountAsked2(newQuestion[0][0], medArray);
      CountAsked2(newQuestion[0][0], hardArray);
      CountCorrect2(newQuestion[0][0], easyArray);
      CountCorrect2(newQuestion[0][0], medArray);
      CountCorrect2(newQuestion[0][0], hardArray);
      //RebalanceArrays();
      CountCorrect(question[0]);
      response = "correct";
      questionState = true;
      power = Math.round(power * 1.1);
    }
    if(newAnswerBank[1][1] == newQuestion[0][1] && a2State == "on") {
      CountCorrect(question[0]);
      CountAsked2(newQuestion[0][0], easyArray);
      CountAsked2(newQuestion[0][0], medArray);
      CountAsked2(newQuestion[0][0], hardArray);
      CountCorrect2(newQuestion[0][0], easyArray);
      CountCorrect2(newQuestion[0][0], medArray);
      CountCorrect2(newQuestion[0][0], hardArray);
      //RebalanceArrays();
      response = "correct";
      questionState = true;
      power = Math.round(power * 1.1);
    }
    if(newAnswerBank[2][1] == newQuestion[0][1] && a3State == "on") {
      //CountAsked(question[0]);
      CountCorrect(question[0]);
      CountAsked2(newQuestion[0][0], easyArray);
      CountAsked2(newQuestion[0][0], medArray);
      CountAsked2(newQuestion[0][0], hardArray);
      CountCorrect2(newQuestion[0][0], easyArray);
      CountCorrect2(newQuestion[0][0], medArray);
      CountCorrect2(newQuestion[0][0], hardArray);
      //RebalanceArrays();
      response = "correct";
      questionState = true;
      power = Math.round(power * 1.1);
    }
    if(newQuestion[0][1] != newAnswerBank[0][1] && a1State == "on") {
      CountAsked2(newQuestion[0][0], easyArray);
      CountAsked2(newQuestion[0][0], medArray);
      CountAsked2(newQuestion[0][0], hardArray);
      //RebalanceArrays();
      response = "wrong";
      questionState = false;
      power = 100;
    }
    if(newQuestion[0][1] != newAnswerBank[1][1] && a2State == "on") {
      CountAsked2(newQuestion[0][0], easyArray);
      CountAsked2(newQuestion[0][0], medArray);
      CountAsked2(newQuestion[0][0], hardArray);
      //RebalanceArrays();
      response = "wrong";
      questionState = false;
      power = 100;
    }
    if(newQuestion[0][1] != newAnswerBank[2][1] && a3State == "on") {
      CountAsked2(newQuestion[0][0], easyArray);
      CountAsked2(newQuestion[0][0], medArray);
      CountAsked2(newQuestion[0][0], hardArray);
      //RebalanceArrays();
      response = "wrong";
      questionState = false;
      power = 100;
    }
    gameState = 2;
  }

}
function ResolvePt2(){

$.ajax({
  method: "POST",
  url: "/save_game_data",
  //data-remote:  "TRUE",
  data: { id: newQuestion[0][5], attempt: dataCorrect }
})


/*$.ajax({
  method: "POST",
  url: "some.php",
  data: { name: "John", location: "Boston" }
})
  .done(function( msg ) {
    alert( "Data Saved: " + msg );
  });*/

/* $.ajax({
    // The URL for the request
    url: "post.php",
    // The data to send (will be converted to a query string)
    data: {
        id: 123
    },
    // Whether this is a POST or GET request
    type: "GET",
    // The type of data we expect back
    dataType : "json",
    // Code to run if the request succeeds;
    // the response is passed to the function
    success: function( json ) {
        //$( "<h1>" ).text( json.title ).appendTo( "body" );
        //$( "<div class=\"content\">").html( json.html ).appendTo( "body" );
    },
    // Code to run if the request fails; the raw request and
    // status codes are passed to the function
    error: function( xhr, status, errorThrown ) {
        alert( "Sorry, there was a problem!" );
        //console.log( "Error: " + errorThrown );
        //console.log( "Status: " + status );
        //console.dir( xhr );
    },
    // Code to run regardless of success or failure
    complete: function( xhr, status ) {
        alert( "The request is complete!" );
    }
}); */

  answerState = undefined;
  questionState = undefined;
  highLow = "";
  highLowX = 100;
  dealerCardX = 325;
  textResponse = "";
  textResponse2 = "";
  bonusPoints = "";
  lowBoxColor = "#D2D2D2";
  highBoxColor = "#D2D2D2";
  a1Color = "#D2D2D2";
  a2Color = "#D2D2D2";
  a3Color = "#D2D2D2";

  discard.push(drawnCard.slice(0,1));
  drawnCard.splice(0,1);
  discard.push(dealerCard.slice(0,1));
  dealerCard.splice(0,1);

  drawnCard = DrawCard(deck);
  gameState = 1;
  keyIn = 100;
  a1State = "off";
  response = "";
  for (i = 0; i < demo.length; i++) {
    demo.splice(0,1);
  }
  demo = CreateQ(charArray);
  demo2 = demo[1][2][1];
  question = demo[0][0];

  a1State = "off";
  a2State = "off";
  a3State = "off";

  a1 = demo[1][0];
  a1Display = a1[1];
  a2 = demo[1][1];
  a2Display = a2[1];
  a3 = demo[1][2];
  a3Display = a3[1];
  UpdateQues();
  dataCorrect = 0;
  adjusted = "";
}
function HiOrLow(MX, MY) {
  if(MX < 90 && MX >40 && MY < 180 && MY > 130) {
    highLow = "low"
    lowBoxColor = "#939393";
    highBoxColor = "#D2D2D2";
    highLowX = 100;
  } else if(MX < 190 && MX > 140 && MY < 180 && MY > 130) {
    highLow = "high"
    highBoxColor = "#939393";
    lowBoxColor = "#D2D2D2";
    highLowX = 100;
  }
}


function CountAsked(question) {
  for(i = 0; i < charArray.length; i++) {
    if (charArray[i][0] == question) {
      charArray[i][2]++;
    }
  }
}
function CountAsked2(question, array) {
  for(i = 0; i < array.length; i++) {
    if (array[i][0] == question) {
      array[i][2]++;
    }
  }
}
function CountCorrect(question) {
  for(i = 0; i < charArray.length; i++) {
    if (charArray[i][0] == question) {
      charArray[i][3]++;
    }
  }
}
function CountCorrect2(question, array) {
  for(i = 0; i < array.length; i++) {
    if (array[i][0] == question) {
      array[i][3]++;
      dataCorrect = 1;
    }
  }
}

//RebalanceArrays();

function drawLabels(){
if(gameOver == false) {

  ctx.rect(40,35,40,70);
  ctx.rect(140,35,40,70);
  ctx.stroke();

  ctx.fillStyle = "#200";
  ctx.font = "14px Arial";

  ctx.fillStyle = "#999";  //alt color is "#939393"

  ctx.fillStyle = a1Color;
  ctx.fillRect(60, 225, 95, 35);

  ctx.fillStyle = a2Color;
  ctx.fillRect(60, 265, 95, 35);

  ctx.fillStyle = a3Color;
  ctx.fillRect(60, 305, 95, 35);

  ctx.fillStyle = lowBoxColor;
  ctx.fillRect(40, 130, 50, 50);  // checkbox for low

  ctx.fillStyle = highBoxColor
  ctx.fillRect(140, 130, 50, 50);  // checkbox for high

  ctx.fillStyle = "#D2D2D2";
  ctx.fillRect(60, 345, 95,35);// continue button

  ctx.fillStyle = "#200";

  /*
  for(i = 0; i<deck.length; i++) {
    j = 0;
    if(i > 12) {
      j = 1;
    }
    if(i > 25) {
      j = 2;
    }
    if(i > 38) {
      j = 3;
    }
    ctx.fillText(deck[i],10+ 50*j,20+20*i - 260*j)
  }
  for(i = 0; i<discard.length; i++) {
    j = 0;
    if(i > 12) {
      j = 1;
    }
    if(i > 25) {
      j = 2;
    }
    if(i > 38) {
      j = 3;
    }
    ctx.fillText(discard[i],600+ 50*j,70+20*i - 260*j)
  }*/
/*
  ctx.fillText("concMasterARand:  " + concMasterARand, 300, 200);
  ctx.fillText("SplitMasterARand: " + SplitMasterARand, 300, 210);
  ctx.fillText("masterAIndex: " + masterAIndex, 300, 220);
  for(i=0; i < possValues.length; i++) {
    ctx.fillText("possValues: " + possValues[i], 300, 230 + 7*i)
  }
  for(i=0; i < newQuestion.length; i++) {
    ctx.fillText("newQuestion: " + newQuestion[i], 300, 255 + 7*i)
  }
  ctx.fillText("newAnwserBank: " + newAnswerBank[0], 300, 270)
  ctx.fillText("newAnwserBank: " + newAnswerBank[1], 300, 285)
  ctx.fillText("newAnwserBank: " + newAnswerBank[2], 300, 300)
  for(i=0; i < displayIndex.length; i++) {
    ctx.fillText("displayIndex: " + displayIndex[i], 300, 315 + 15*i)
  }

  for(i=0; i < newAnswerBank.length; i++) {
    ctx.fillText("newAnwserBank: " + newAnswerBank[i], 500, 200 + 15*i)
  }


  ctx.fillText("dataCharacter: " + dataCharacter, 300, 50);
  ctx.fillText("dataCorrect : " + dataCorrect, 300, 65);

  ctx.fillText("easyArray", 450, 13);
  for(i = 0; i < easyArray.length; i ++) {
    ctx.fillText(easyArray[i][0] + " " + easyArray[i][1] + " " + easyArray[i][2] + " " + easyArray[i][3] + " " + easyArray[i][4], 450, 26 + 13 *i)
  }
  ctx.fillText("medArray", 580, 13);
  for(i = 0; i < medArray.length; i ++) {
    ctx.fillText(medArray[i][0] + " " + medArray[i][1] + " " + medArray[i][2] + " " + medArray[i][3] + " " + medArray[i][4], 580, 26 + 13 *i)
  }
  ctx.fillText("hardArray", 700, 13);
  for(i = 0; i < hardArray.length; i ++) {
    ctx.fillText(hardArray[i][0] + " " + hardArray[i][1] + " " + hardArray[i][2] + " " + hardArray[i][3] + " " + hardArray[i][4], 700, 26 + 13 *i)
  }*/

  ctx.fillText("Mem: 小苹果", 110, 20);

  ctx.fillText(drawnCard, 62, 70);
  ctx.fillText(dealerCard, 162, 70);

  ctx.fillText("Bet", 63, 150);
  ctx.fillText("low", 63, 165);
  ctx.fillText("Bet", 163, 150);
  ctx.fillText("high", 163, 165);

  ctx.fillText(textResponse, 80 ,120);
  //ctx.fillText(textResponse2, 60, 160);
  if (adjusted != "") {
    ctx.fillText(Math.abs(adjusted) + " pts!", 140, 120);
  }

  ctx.fillText("Question: "+ newQuestion[0][displayIndex[0]], 110, 200);
  ctx.fillText(response, 110, 215);

  ctx.textAlign = "center"
  ctx.fillText(newAnswerBank[0][displayIndex[1]], 110, 245);
  ctx.fillText(newAnswerBank[1][displayIndex[1]], 110, 285);
  ctx.fillText(newAnswerBank[2][displayIndex[1]], 110 , 325);

  //ctx.fillText(a1State, 250, 220);
  //ctx.fillText(a2State, 250, 245);
  //ctx.fillText(a3State, 250, 270);

  ctx.fillText("score: " + chips, 110, 395);
  ctx.fillText("Power: " + power, 110, 410);

  ctx.fillText("continue", 110, 365);

  //ctx.fillRect(270, 285, 20,20);


  //ctx.fillText("question: " + question[0], 10, 420);
  //ctx.fillText("charArray[0]:" + charArray[0], 10, 390);
  //ctx.fillText(highLow + ":to be removed", 225, 180);

} else {
  ctx.fillStyle = "#200";
  ctx.font = "700 13px Arial";
  ctx.textAlign = "center"
  ctx.fillText("Congratulations!!!", 110, 160);
  ctx.fillText(chips+ " points", 110, 180)
  ctx.fillText("added to your profile!", 110, 200);
}

}
function Clicked(x, y, l, w) {
  if(mXcd > x &&
  mXcd < x + w &&
  mYcd > y &&
  mYcd < y + l) {
    counter += 100
    return true;
  }
}

function MouseMove(e){
  e = e || window.event;
  var target = e.target || e.srcElement;
  var rect = target.getBoundingClientRect();
  mXcd = e.clientX - rect.left;
  mYcd = e.clientY - rect.top;
}
function OnClick(e){

  if(gameOver == false) {
    //check = typeof keyIn;
    if(Clicked(60, 225, 35, 95) && a1State == "off") {
      a1State = "on";
      a1Color = "#939393";
      a2State = "off";
      a2Color = "#D2D2D2";
      a3State = "off";
      a3Color = "#D2D2D2";
    } else {
      if(Clicked(60, 225, 35, 95) && a1State == "on") {
        a1State = "off";
        a1Color = "#D2D2D2";
      }
    }
    if(Clicked(60, 265, 35, 95) && a2State == "off") {
      a2State = "on";
      a2Color = "#939393";
      a1State = "off";
      a1Color = "#D2D2D2";
      a3State = "off";
      a3Color = "#D2D2D2";
    } else {
      if(Clicked(60, 265, 35, 95) && a2State == "on") {
        a2State = "off";
        a2Color = "#D2D2D2";
      }
    }
    if(Clicked(60, 305, 35, 95) && a3State == "off") {
      a3State = "on";
      a3Color = "#939393";
      a1State = "off";
      a1Color = "#D2D2D2";
      a2State = "off";
      a2Color = "#D2D2D2";
    } else {
      if(Clicked(60, 305, 35, 95) && a3State == "on") {
        a3State = "off";
        a3Color = "#D2D2D2";
      }
    }
    //Clicked(300, 250, 30, 30)
    HiOrLow(mXcd, mYcd)
    counter++;
    if(gameState == 1) {
      ResolvePt1();
    } else if (gameState ==2) {
      ResolvePt2();
    }
  }

}
function KeyIsPressed(e){
  var keyPressed = String.fromCharCode(event.keyCode);
  if(keyIn == undefined) {
    keyIn = keyPressed
    //keyIn = 0;
  } else {
    keyIn +=keyPressed;
  }
  check = typeof(bet);
}
function KeyDownDown(e){
  var keyDown = event.keyCode;
  if(keyDown == 8) {
    keyIn = keyIn.slice(0,keyIn.length-1);
  }
}

canvas.addEventListener("mousemove", MouseMove, true);
window.addEventListener("mousedown", OnClick, true);
window.addEventListener("keypress", KeyIsPressed, true);
window.addEventListener("keydown", KeyDownDown, true);

window.requestAnimFrame = (function(){

  return window.requestAnimationFrame

  || window.webkitRequestAnimationFrame

  || window.mozRequestAnimationFrame

  || window.oRequestAnimationFrame

  || window.msRequestAnimationFrame

  || function( callback ){ return window.setTimeout(callback, FPS);
  };
}

)();


window.cancelRequestAnimFrame = (function() {

  return window.cancelAnimationFrame

    || window.webkitCancelRequestAnimationFrame
    || window.mozCancelRequestAnimationFrame

    || window.oCancelRequestAnimationFrame

    || window.msCancelRequestAnimationFrame
      || clearTimeout }

)();

function Paint(){

  BG.Paint();

}

function Loop(){

  if (deck.length == 0) {
    deck= RandArr(discard);
    $.ajax({
     method: "POST",
      url: "/save_points",
      data: { chipswon: chips}
      })
    gameOver = true;
  }
  init = requestAnimFrame(Loop);

  now = Date.now();
  difference = now - then;
  then = Date.now();
  Paint();
  drawLabels();
};
function NewGame(){

  deck = RandArr(deck);
  gameState =1;
  drawnCard = DrawCard(deck);
  keyIn = 100;
  gameTimeStart = Date.now();
  then = Date.now();
  Loop();

}



if (newQuestion[0][1] == newAnswerBank[0][1]) {
  result = "yes!"
}
NewGame();

</script>
</head>
